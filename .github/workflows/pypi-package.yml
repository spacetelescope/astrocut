name: Building & Publishing

on:
  push:
    branches: [main]
    tags: ["*"]

permissions:
  contents: read
  id-token: write

jobs:

  # Release to PyPI after a RELEASE gets PUBLISHED in @spacetelescope/astrocut/main
  publish-to-pypi:
    uses: OpenAstronomy/github-actions-workflows/.github/workflows/publish_pure_python.yml@v1
    name: Publish to PyPI

    # We only want to upload to PyPI after a new release has been published on the @spacetelescope/astrocut repo
    if: github.repository_owner == 'spacetelescope' && github.event_name == 'push'
    with:
      test_extras: test, all
      test_command: pytest astrocut/test*.py